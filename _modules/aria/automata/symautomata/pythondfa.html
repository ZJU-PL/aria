

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>aria.automata.symautomata.pythondfa &mdash; ARIA Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=9edc463e" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=01f34227"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            ARIA
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">ARIA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">aria.automata.symautomata.pythondfa</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for aria.automata.symautomata.pythondfa</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module performs all basic DFA operations, without pyfst</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">#!/usr/bin/python</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">operator</span><span class="w"> </span><span class="kn">import</span> <span class="n">attrgetter</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">aria.automata.symautomata.alphabet</span><span class="w"> </span><span class="kn">import</span> <span class="n">createalphabet</span>

<span class="n">EPSILON</span> <span class="o">=</span> <span class="mh">0xFFFF</span>


<div class="viewcode-block" id="tropical_weight">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.tropical_weight">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">tropical_weight</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>  <span class="c1"># pylint: disable=invalid-name</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the emulated fst TropicalWeight</span>
<span class="sd">    Args:</span>
<span class="sd">        param (str): The input</span>
<span class="sd">    Returns:</span>
<span class="sd">        bool: The arc weight</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span></div>



<span class="c1"># Keep old name for backward compatibility</span>
<span class="n">TropicalWeight</span> <span class="o">=</span> <span class="n">tropical_weight</span>  <span class="c1"># pylint: disable=invalid-name</span>


<div class="viewcode-block" id="DFAState">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.DFAState">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DFAState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The DFA statess&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialization function</span>
<span class="sd">        Args:</span>
<span class="sd">            sid (int): The state identifier</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookup</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stateid</span> <span class="o">=</span> <span class="n">sid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arcs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterator&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arcs</span><span class="p">)</span></div>



<div class="viewcode-block" id="DFAArc">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.DFAArc">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DFAArc</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The DFA transition&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">srcstate_id</span><span class="p">,</span> <span class="n">nextstate_id</span><span class="p">,</span> <span class="n">ilabel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The initialization function</span>
<span class="sd">        Args:</span>
<span class="sd">            srcstate_id (int): The source state identifier</span>
<span class="sd">            nextstate_id (int): The destination state identifier</span>
<span class="sd">            ilabel (str): The symbol corresponding to character for the transition</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">srcstate</span> <span class="o">=</span> <span class="n">srcstate_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nextstate</span> <span class="o">=</span> <span class="n">nextstate_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ilabel</span> <span class="o">=</span> <span class="n">ilabel</span></div>



<div class="viewcode-block" id="Syms">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.Syms">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Syms</span><span class="p">:</span>  <span class="c1"># pylint: disable=invalid-name</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The DFA accepted symbols&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize symbols&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reversesymbols</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds a symbol identifier based on the input character</span>
<span class="sd">        Args:</span>
<span class="sd">            char (str): The symbol character</span>
<span class="sd">        Returns:</span>
<span class="sd">            int: The retrieved symbol identifier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reversesymbols</span><span class="p">[</span><span class="n">char</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets a symbol</span>
<span class="sd">        Args:</span>
<span class="sd">            char (str): The symbol character</span>
<span class="sd">            num (int): The  symbol identifier</span>
<span class="sd">        Returns:</span>
<span class="sd">           None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">char</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reversesymbols</span><span class="p">[</span><span class="n">char</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span>

<div class="viewcode-block" id="Syms.find">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.Syms.find">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds a symbol based on its identifier</span>
<span class="sd">        Args:</span>
<span class="sd">            num (int): The symbol identifier</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: The retrieved symbol</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="n">num</span><span class="p">]</span></div>


<div class="viewcode-block" id="Syms.items">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.Syms.items">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns all stored symbols</span>
<span class="sd">        Args:</span>
<span class="sd">            None</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict:The included symbols</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span></div>
</div>



<div class="viewcode-block" id="PythonDFA">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PythonDFA</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A DFA implementation that uses the</span>
<span class="sd">    same interface with python symautomata&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alphabet</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">alphabet</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">alphabet</span> <span class="o">=</span> <span class="n">createalphabet</span><span class="p">()</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            alphabet (list): The imput alphabet</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alphabet</span> <span class="o">=</span> <span class="n">alphabet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfa</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">num</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isyms</span> <span class="o">=</span> <span class="n">Syms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">osyms</span> <span class="o">=</span> <span class="n">Syms</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">alphabet</span> <span class="o">+</span> <span class="p">[</span><span class="n">EPSILON</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isyms</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">osyms</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
            <span class="n">num</span> <span class="o">=</span> <span class="n">num</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yy_last_accepting_state</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yy_accept</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;String representation of the DFA&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;This is a python DFA object with &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; states&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves a state</span>
<span class="sd">        Args:</span>
<span class="sd">            state (int): State identifier</span>
<span class="sd">        Returns:</span>
<span class="sd">            DFA state: The selected dfa state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">newstate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets a new state</span>
<span class="sd">        Args:</span>
<span class="sd">            state (int): State identifier</span>
<span class="sd">            newstate (DFA State): The selected dfa state</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">=</span> <span class="n">newstate</span>

<div class="viewcode-block" id="PythonDFA.define">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.define">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">define</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;If DFA is empty, create a sink state&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphabet</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_arc</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="PythonDFA.add_state">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.add_state">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a new state&quot;&quot;&quot;</span>
        <span class="n">sid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DFAState</span><span class="p">(</span><span class="n">sid</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">sid</span></div>


<div class="viewcode-block" id="PythonDFA.add_arc">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.add_arc">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_arc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a new Arc</span>
<span class="sd">        Args:</span>
<span class="sd">            src (int): The source state identifier</span>
<span class="sd">            dst (int): The destination state identifier</span>
<span class="sd">            char (str): The character for the transition</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># assert type(src) == type(int()) and type(dst) == type(int()), \</span>
        <span class="c1">#     &quot;State type should be integer.&quot;</span>
        <span class="c1"># assert char in self.I</span>
        <span class="c1">#</span>
        <span class="c1"># print self.states</span>
        <span class="c1"># print src</span>
        <span class="k">for</span> <span class="n">s_idx</span> <span class="ow">in</span> <span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">s_idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">),</span> <span class="n">s_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DFAState</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">src</span><span class="p">]</span><span class="o">.</span><span class="n">arcs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">arc</span><span class="o">.</span><span class="n">ilabel</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">isyms</span><span class="p">[</span><span class="n">char</span><span class="p">]</span> <span class="ow">or</span> <span class="n">char</span> <span class="o">==</span> <span class="n">EPSILON</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nfa</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">src</span><span class="p">]</span><span class="o">.</span><span class="n">arcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DFAArc</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isyms</span><span class="p">[</span><span class="n">char</span><span class="p">]))</span></div>


<div class="viewcode-block" id="PythonDFA.fixminimized">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.fixminimized">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fixminimized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alphabet</span><span class="p">):</span>  <span class="c1"># pylint: disable=unused-argument</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        After pyfst minimization,</span>
<span class="sd">        all unused arcs are removed,</span>
<span class="sd">        and all sink states are removed.</span>
<span class="sd">        However this may break compatibility.</span>
<span class="sd">        Args:</span>
<span class="sd">            alphabet (list): The input alphabet</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span></div>

        <span class="c1"># endstate = self.add_state()</span>
        <span class="c1"># for state in self.states:</span>
        <span class="c1">#     for char in alphabet:</span>
        <span class="c1">#         found = 0</span>
        <span class="c1">#         for arc in state.arcs:</span>
        <span class="c1">#             if self.isyms.find(arc.ilabel) == char:</span>
        <span class="c1">#                 found = 1</span>
        <span class="c1">#                 break</span>
        <span class="c1">#         if found == 0:</span>
        <span class="c1">#             self.add_arc(state.stateid, endstate, char)</span>
        <span class="c1">#</span>
        <span class="c1"># self[endstate].final = False</span>
        <span class="c1">#</span>
        <span class="c1"># for char in alphabet:</span>
        <span class="c1">#     self.add_arc(endstate, endstate, char)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_addsink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alphabet</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a sink state</span>
<span class="sd">        Args:</span>
<span class="sd">            alphabet (list): The input alphabet</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endstate</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">alphabet</span><span class="p">:</span>
                <span class="n">found</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">arcs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isyms</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">ilabel</span><span class="p">)</span> <span class="o">==</span> <span class="n">char</span><span class="p">:</span>
                        <span class="n">found</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_arc</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">stateid</span><span class="p">,</span> <span class="n">endstate</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span>

        <span class="bp">self</span><span class="p">[</span><span class="n">endstate</span><span class="p">]</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">alphabet</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_arc</span><span class="p">(</span><span class="n">endstate</span><span class="p">,</span> <span class="n">endstate</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span>

<div class="viewcode-block" id="PythonDFA.consume_input">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.consume_input">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">consume_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True/False if the machine accepts/reject the input.</span>
<span class="sd">        Args:</span>
<span class="sd">            inp (str): input string to be consumed</span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: A true or false value depending on if the DFA</span>
<span class="sd">                accepts the provided input</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cur_state</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;initial&quot;</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yy_accept</span><span class="p">[</span><span class="n">cur_state</span><span class="o">.</span><span class="n">stateid</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yy_last_accepting_state</span> <span class="o">=</span> <span class="n">cur_state</span>
            <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="n">cur_state</span><span class="o">.</span><span class="n">arcs</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isyms</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">ilabel</span><span class="p">)</span> <span class="o">==</span> <span class="n">inp</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">cur_state</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">arc</span><span class="o">.</span><span class="n">nextstate</span><span class="p">]</span>
                    <span class="n">inp</span> <span class="o">=</span> <span class="n">inp</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">cur_state</span><span class="o">.</span><span class="n">stateid</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">yy_last_accepting_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">yy_accept</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">yy_last_accepting_state</span><span class="o">.</span><span class="n">stateid</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">cur_state</span><span class="o">.</span><span class="n">final</span></div>


<div class="viewcode-block" id="PythonDFA.trace_partial_input">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.trace_partial_input">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">trace_partial_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of (state, char) traversed by the inp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">traversed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">cur_state</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;initial&quot;</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">traversed</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cur_state</span><span class="o">.</span><span class="n">stateid</span><span class="p">,</span> <span class="n">inp</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yy_accept</span><span class="p">[</span><span class="n">cur_state</span><span class="o">.</span><span class="n">stateid</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yy_last_accepting_state</span> <span class="o">=</span> <span class="n">cur_state</span>
            <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="n">cur_state</span><span class="o">.</span><span class="n">arcs</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isyms</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">ilabel</span><span class="p">)</span> <span class="o">==</span> <span class="n">inp</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">cur_state</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">arc</span><span class="o">.</span><span class="n">nextstate</span><span class="p">]</span>
                    <span class="n">inp</span> <span class="o">=</span> <span class="n">inp</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">traversed</span></div>


<div class="viewcode-block" id="PythonDFA.empty">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.empty">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if the DFA accepts the empty language.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self.minimize()</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="PythonDFA.complement">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.complement">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">complement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alphabet</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the complement of DFA</span>
<span class="sd">        Args:</span>
<span class="sd">            alphabet (list): The input alphabet</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">states</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;initial&quot;</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">final</span><span class="p">:</span>
                <span class="n">state</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">state</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="PythonDFA.init_from_acceptor">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.init_from_acceptor">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">init_from_acceptor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acceptor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a sink state</span>
<span class="sd">        Args:</span>
<span class="sd">            alphabet (list): The input alphabet</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">acceptor</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alphabet</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">acceptor</span><span class="o">.</span><span class="n">alphabet</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">osyms</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">acceptor</span><span class="o">.</span><span class="n">osyms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isyms</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">acceptor</span><span class="o">.</span><span class="n">isyms</span><span class="p">)</span></div>


<div class="viewcode-block" id="PythonDFA.save">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.save">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txt_fst_file_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the machine in the openFST format in the file denoted by</span>
<span class="sd">        txt_fst_file_name.</span>
<span class="sd">        Args:</span>
<span class="sd">            txt_fst_file_name (str): The output file</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">txt_fst_file_name</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_filename</span><span class="p">:</span>
            <span class="n">states</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;initial&quot;</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">arcs</span><span class="p">:</span>
                    <span class="n">itext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isyms</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">ilabel</span><span class="p">)</span>
                    <span class="n">otext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">osyms</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">ilabel</span><span class="p">)</span>
                    <span class="n">output_filename</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="o">.</span><span class="n">stateid</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">arc</span><span class="o">.</span><span class="n">nextstate</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">itext</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;hex&quot;</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">otext</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;hex&quot;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">final</span><span class="p">:</span>
                    <span class="n">output_filename</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">state</span><span class="o">.</span><span class="n">stateid</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PythonDFA.load">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.load">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txt_fst_file_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the transducer in the text file format of OpenFST.</span>
<span class="sd">        The format is specified as follows:</span>
<span class="sd">            arc format: src dest ilabel olabel [weight]</span>
<span class="sd">            final state format: state [weight]</span>
<span class="sd">        lines may occur in any order except initial state must be first line</span>
<span class="sd">        Args:</span>
<span class="sd">            txt_fst_file_name (str): The input file</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">txt_fst_file_name</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_filename</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">input_filename</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">split_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">split_line</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_arc</span><span class="p">(</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">split_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">split_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="n">split_line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;hex&quot;</span><span class="p">),</span>
                    <span class="p">)</span></div>


<div class="viewcode-block" id="PythonDFA.minimize">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.minimize">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">minimize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Minimizes the DFA using Hopcroft algorithm&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hopcroft</span><span class="p">()</span></div>


<div class="viewcode-block" id="PythonDFA.intersect">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.intersect">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">intersect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructs an unminimized DFA recognizing</span>
<span class="sd">        the intersection of the languages of two given DFAs.</span>
<span class="sd">        Args:</span>
<span class="sd">            other (DFA): The other DFA that will be used</span>
<span class="sd">                         for the intersect operation</span>
<span class="sd">        Returns:</span>
<span class="sd">        Returns:</span>
<span class="sd">            DFA: The resulting DFA</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">operation</span> <span class="o">=</span> <span class="nb">bool</span><span class="o">.</span><span class="fm">__and__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cross_product</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operation</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructs an unminimized DFA recognizing</span>
<span class="sd">        the intersection of the languages of two given DFAs.</span>
<span class="sd">        Args:</span>
<span class="sd">            other (DFA): The other DFA that will be used</span>
<span class="sd">                         for the intersect operation</span>
<span class="sd">        Returns:</span>
<span class="sd">            DFA: The resulting DFA</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="PythonDFA.symmetric_difference">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.symmetric_difference">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">symmetric_difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructs an unminimized DFA recognizing</span>
<span class="sd">        the symmetric difference of the languages of two given DFAs.</span>
<span class="sd">        Args:</span>
<span class="sd">            other (DFA): The other DFA that will be used</span>
<span class="sd">                         for the symmetric difference operation</span>
<span class="sd">        Returns:</span>
<span class="sd">            DFA: The resulting DFA</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">operation</span> <span class="o">=</span> <span class="nb">bool</span><span class="o">.</span><span class="fm">__xor__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cross_product</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operation</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="PythonDFA.union">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.union">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructs an unminimized DFA recognizing the union of the languages of two given DFAs.</span>
<span class="sd">        Args:</span>
<span class="sd">            other (DFA): The other DFA that will be used</span>
<span class="sd">                         for the union operation</span>
<span class="sd">        Returns:</span>
<span class="sd">            DFA: The resulting DFA</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">operation</span> <span class="o">=</span> <span class="nb">bool</span><span class="o">.</span><span class="fm">__or__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cross_product</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operation</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructs an unminimized DFA recognizing the union of the languages of two given DFAs.</span>
<span class="sd">        Args:</span>
<span class="sd">            other (DFA): The other DFA that will be used</span>
<span class="sd">                         for the union operation</span>
<span class="sd">        Returns:</span>
<span class="sd">            DFA: The resulting DFA</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_epsilon_closure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the \epsilon-closure for the state given as input.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">closure</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">state</span><span class="o">.</span><span class="n">stateid</span><span class="p">])</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="p">[</span><span class="n">state</span><span class="p">]</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">stack</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isyms</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">ilabel</span><span class="p">)</span> <span class="o">!=</span> <span class="n">EPSILON</span> <span class="ow">or</span> <span class="n">arc</span><span class="o">.</span><span class="n">nextstate</span> <span class="ow">in</span> <span class="n">closure</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">closure</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">nextstate</span><span class="p">)</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">arc</span><span class="o">.</span><span class="n">nextstate</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">closure</span>

<div class="viewcode-block" id="PythonDFA.determinize">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.determinize">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">determinize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transforms a Non Deterministic DFA into a Deterministic</span>
<span class="sd">        Args:</span>
<span class="sd">            None</span>
<span class="sd">        Returns:</span>
<span class="sd">            DFA: The resulting DFA</span>

<span class="sd">        Creating an equivalent DFA is done using the standard algorithm.</span>
<span class="sd">        A nice description can be found in the book:</span>
<span class="sd">        Harry R. Lewis and Christos H. Papadimitriou. 1998.</span>
<span class="sd">        E</span>
<span class="sd">        print target_dfa_statelements of the Theory of Computation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Compute the epsilon-closure for all states and save it in a diagram</span>
        <span class="n">epsilon_closure</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>
            <span class="n">sid</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">stateid</span>
            <span class="n">epsilon_closure</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon_closure</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

        <span class="c1"># Get a transition diagram to speed up computations</span>
        <span class="n">trans_table</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>
            <span class="n">trans_table</span><span class="p">[</span><span class="n">state</span><span class="o">.</span><span class="n">stateid</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
                <span class="n">char</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isyms</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">ilabel</span><span class="p">)</span>
                <span class="n">trans_table</span><span class="p">[</span><span class="n">state</span><span class="o">.</span><span class="n">stateid</span><span class="p">][</span><span class="n">char</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">nextstate</span><span class="p">)</span>

        <span class="c1"># is_final function:</span>
        <span class="c1"># Given a set of nfa states representing a dfa_state return 1 if the</span>
        <span class="c1"># corresponding DFA state is a final state, i.e. if any of the</span>
        <span class="c1"># corresponding NFA states are final.</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">is_final</span><span class="p">(</span><span class="n">nfa_states</span><span class="p">,</span> <span class="n">dfa_state</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Check if any NFA state in the DFA state is final.&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfa_states</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">final</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dfa_state</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span>

        <span class="c1"># Precomputation is over, start executing the conversion algorithm</span>
        <span class="n">state_idx</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">nfa_states</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Initialize the new DFA state list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_state</span><span class="p">()</span>
        <span class="n">new_initial</span> <span class="o">=</span> <span class="n">epsilon_closure</span><span class="p">[</span><span class="n">nfa_states</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stateid</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="n">is_final</span><span class="p">(</span><span class="n">nfa_states</span><span class="p">,</span> <span class="n">new_initial</span><span class="p">)</span>

        <span class="n">dfa_state_idx_map</span> <span class="o">=</span> <span class="p">{</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">new_initial</span><span class="p">):</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_initial</span><span class="p">]</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Iterate until all added DFA states are processed.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">stack</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="c1"># This is a set of states from the NFA</span>
            <span class="n">src_dfa_state</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">src_dfa_state_idx</span> <span class="o">=</span> <span class="n">dfa_state_idx_map</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">src_dfa_state</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphabet</span><span class="p">:</span>
                <span class="c1"># Compute the set of target states</span>
                <span class="n">target_dfa_state</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
                <span class="k">for</span> <span class="n">nfa_state</span> <span class="ow">in</span> <span class="n">src_dfa_state</span><span class="p">:</span>
                    <span class="n">next_states</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">y</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">trans_table</span><span class="p">[</span><span class="n">nfa_state</span><span class="p">][</span><span class="n">char</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">epsilon_closure</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
                    <span class="p">}</span>
                    <span class="n">target_dfa_state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">next_states</span><span class="p">)</span>
                <span class="c1"># If the computed state set is not part of our new DFA add it,</span>
                <span class="c1"># along with the transition for the current character.</span>
                <span class="k">if</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">target_dfa_state</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dfa_state_idx_map</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_state</span><span class="p">()</span>
                    <span class="n">dfa_state_idx_map</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">target_dfa_state</span><span class="p">)]</span> <span class="o">=</span> <span class="n">state_idx</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">state_idx</span><span class="p">]</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="n">is_final</span><span class="p">(</span>
                        <span class="n">nfa_states</span><span class="p">,</span> <span class="n">target_dfa_state</span>
                    <span class="p">)</span>
                    <span class="n">state_idx</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target_dfa_state</span><span class="p">)</span>

                <span class="n">dst_state_idx</span> <span class="o">=</span> <span class="n">dfa_state_idx_map</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">target_dfa_state</span><span class="p">)]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_arc</span><span class="p">(</span><span class="n">src_dfa_state_idx</span><span class="p">,</span> <span class="n">dst_state_idx</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="PythonDFA.invert">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.invert">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">invert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Inverts the DFA final states&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">final</span><span class="p">:</span>
                <span class="n">state</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">state</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="PythonDFA.difference">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.difference">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs the Diff operation between two atomata</span>
<span class="sd">        Args:</span>
<span class="sd">            other (DFA): The other DFA that will be used</span>
<span class="sd">                         for the difference operation</span>
<span class="sd">        Returns:</span>
<span class="sd">            DFA: The resulting DFA</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">other</span><span class="o">.</span><span class="n">invert</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs the Diff operation between two atomata</span>
<span class="sd">        Args:</span>
<span class="sd">            other (DFA): The other DFA that will be used</span>
<span class="sd">                        for the difference operation</span>
<span class="sd">        Returns:</span>
<span class="sd">            DFA: The resulting DFA</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="PythonDFA.hopcroft">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.hopcroft">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">hopcroft</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs the Hopcroft minimization algorithm</span>
<span class="sd">        Args:</span>
<span class="sd">            None</span>
<span class="sd">        Returns:</span>
<span class="sd">            DFA: The minimized input DFA</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_getset</span><span class="p">(</span><span class="n">testset</span><span class="p">,</span> <span class="n">partition</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Checks if a set is in a partition</span>
<span class="sd">            Args:</span>
<span class="sd">                testset (set): The examined set</span>
<span class="sd">                partition (list): A list of sets</span>
<span class="sd">            Returns:</span>
<span class="sd">                bool: A value indicating if it is a member or not</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">partition</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">testset</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">part</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_create_transitions_representation</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            In order to speedup the transition iteration using</span>
<span class="sd">            the alphabet, the function creates an index</span>
<span class="sd">            Args:</span>
<span class="sd">                graph (DFA): The input dfa</span>
<span class="sd">                state (DFA state): The examined state</span>
<span class="sd">            Returns:</span>
<span class="sd">                dict: The generated transition map</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="n">x</span><span class="o">.</span><span class="n">stateid</span><span class="p">:</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">isyms</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">ilabel</span><span class="p">):</span> <span class="n">arc</span><span class="o">.</span><span class="n">nextstate</span> <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="n">x</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">states</span>
            <span class="p">}</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_create_reverse_transitions_representation</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            In order to speedup the transition iteration using</span>
<span class="sd">            the alphabet, the function creates an index</span>
<span class="sd">            Args:</span>
<span class="sd">                graph (DFA): The input dfa</span>
<span class="sd">                state (DFA state): The examined state</span>
<span class="sd">            Returns:</span>
<span class="sd">                dict: The generated transition map</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="n">x</span><span class="o">.</span><span class="n">stateid</span><span class="p">:</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">isyms</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">ilabel</span><span class="p">):</span> <span class="n">arc</span><span class="o">.</span><span class="n">nextstate</span> <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="n">x</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">states</span>
            <span class="p">}</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_reverse_to_source</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">group1</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Args:</span>
<span class="sd">                target (dict): A table containing the reverse transitions for each state</span>
<span class="sd">                group1 (list): A group of states</span>
<span class="sd">            Return:</span>
<span class="sd">                Set: A set of states for which there is a transition with the states of the group</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">new_group</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">group1</span><span class="p">:</span>
                <span class="n">new_group</span> <span class="o">+=</span> <span class="n">target</span><span class="p">[</span><span class="n">dst</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">new_group</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_get_group_from_state</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">sid</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Args:</span>
<span class="sd">                sid (int): The state identifier</span>
<span class="sd">            Return:</span>
<span class="sd">                int: The group identifier that the state belongs</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">selectgroup</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">selectgroup</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">index</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_delta</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">cur_state</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Function describing the transitions</span>
<span class="sd">            Args:</span>
<span class="sd">                graph (DFA): The DFA states</span>
<span class="sd">                cur_state (DFA state): The DFA current state</span>
<span class="sd">                char (str):: The char that will be used for the transition</span>
<span class="sd">            Return:</span>
<span class="sd">                DFA Node: The next state</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="n">cur_state</span><span class="o">.</span><span class="n">arcs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">graph</span><span class="o">.</span><span class="n">isyms</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">ilabel</span><span class="p">)</span> <span class="o">==</span> <span class="n">char</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">graph</span><span class="p">[</span><span class="n">arc</span><span class="o">.</span><span class="n">nextstate</span><span class="p">]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_partition_group</span><span class="p">(</span><span class="n">bookeeping</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Args:</span>
<span class="sd">                group (list):  A group of states</span>
<span class="sd">            Return:</span>
<span class="sd">                tuple: A set of two groups</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">group1</span><span class="p">,</span> <span class="n">group2</span> <span class="ow">in</span> <span class="n">bookeeping</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">group</span> <span class="o">&amp;</span> <span class="n">group1</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">group</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">group1</span><span class="p">):</span>
                    <span class="n">new_g1</span> <span class="o">=</span> <span class="n">group</span> <span class="o">&amp;</span> <span class="n">group1</span>
                    <span class="n">new_g2</span> <span class="o">=</span> <span class="n">group</span> <span class="o">-</span> <span class="n">group1</span>
                    <span class="k">return</span> <span class="p">(</span><span class="n">new_g1</span><span class="p">,</span> <span class="n">new_g2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">group</span> <span class="o">&amp;</span> <span class="n">group2</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">group</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">group2</span><span class="p">):</span>
                    <span class="n">new_g1</span> <span class="o">=</span> <span class="n">group</span> <span class="o">&amp;</span> <span class="n">group2</span>
                    <span class="n">new_g2</span> <span class="o">=</span> <span class="n">group</span> <span class="o">-</span> <span class="n">group2</span>
                    <span class="k">return</span> <span class="p">(</span><span class="n">new_g1</span><span class="p">,</span> <span class="n">new_g2</span><span class="p">)</span>
            <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Unmatched group partition&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_object_set_to_state_list</span><span class="p">(</span><span class="n">objectset</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Args:</span>
<span class="sd">                objectset (list): A list of all the DFA states (as objects)</span>
<span class="sd">            Return:</span>
<span class="sd">                list: A list of all the DFA states (as identifiers)</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">state</span><span class="o">.</span><span class="n">stateid</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">objectset</span><span class="p">]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_get_accepted</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Find the accepted states</span>
<span class="sd">            Args:</span>
<span class="sd">                graph (DFA): The DFA states</span>
<span class="sd">            Return:</span>
<span class="sd">                list: Returns the list of the accepted states</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">state</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">final</span> <span class="o">!=</span> <span class="n">TropicalWeight</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">))</span>
            <span class="p">]</span>

        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c1"># Find Q</span>
        <span class="n">set_q</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">_object_set_to_state_list</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">states</span><span class="p">))</span>
        <span class="c1"># We will work with states addresses here instead of states stateid for</span>
        <span class="c1"># more convenience</span>
        <span class="n">set_f</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">_object_set_to_state_list</span><span class="p">(</span><span class="n">_get_accepted</span><span class="p">(</span><span class="n">graph</span><span class="p">)))</span>
        <span class="c1"># Perform P := {F, Q-F}</span>
        <span class="n">set_nf</span> <span class="o">=</span> <span class="n">set_q</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">-</span> <span class="n">set_f</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">set_f</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">set_nf</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>
        <span class="n">bookeeping</span> <span class="o">=</span> <span class="p">[(</span><span class="n">set_f</span><span class="p">,</span> <span class="n">set_nf</span><span class="p">)]</span>

        <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
            <span class="n">done</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">new_groups</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">selectgroup</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
                <span class="c1"># _check for each letter if it splits the current group</span>
                <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphabet</span><span class="p">:</span>
                    <span class="c1"># print &#39;Testing symbol: &#39;, c</span>
                    <span class="n">target</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
                    <span class="n">target_states</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                    <span class="n">new_g</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">selectgroup</span><span class="p">)]</span>
                    <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">selectgroup</span><span class="p">:</span>
                        <span class="c1"># _check if all transitions using c are going in a state</span>
                        <span class="c1"># in the same group. If they are going on a different</span>
                        <span class="c1"># group then split</span>
                        <span class="n">deststate</span> <span class="o">=</span> <span class="n">_delta</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">graph</span><span class="p">[</span><span class="n">sid</span><span class="p">],</span> <span class="n">character</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">deststate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">destgroup</span> <span class="o">=</span> <span class="n">_get_group_from_state</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">deststate</span><span class="o">.</span><span class="n">stateid</span><span class="p">)</span>
                        <span class="n">target</span><span class="p">[</span><span class="n">destgroup</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
                        <span class="n">target_states</span><span class="p">[</span><span class="n">destgroup</span><span class="p">]</span> <span class="o">=</span> <span class="n">deststate</span><span class="o">.</span><span class="n">stateid</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>

                        <span class="n">inv_target_states</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">target_states</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                        <span class="n">new_g</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="nb">set</span><span class="p">(</span><span class="n">selectedstate</span><span class="p">)</span> <span class="k">for</span> <span class="n">selectedstate</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                        <span class="p">]</span>  <span class="c1"># pylint: disable=unnecessary-comprehension</span>
                        <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="c1"># Get all the partitions of destgroups</span>
                        <span class="n">queue</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">target_states</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
                        <span class="k">while</span> <span class="n">queue</span><span class="p">:</span>
                            <span class="n">top</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                            <span class="p">(</span><span class="n">group1</span><span class="p">,</span> <span class="n">group2</span><span class="p">)</span> <span class="o">=</span> <span class="n">_partition_group</span><span class="p">(</span><span class="n">bookeeping</span><span class="p">,</span> <span class="n">top</span><span class="p">)</span>
                            <span class="n">ng1</span> <span class="o">=</span> <span class="n">_reverse_to_source</span><span class="p">(</span>
                                <span class="n">target</span><span class="p">,</span> <span class="p">[</span><span class="n">inv_target_states</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">group1</span><span class="p">]</span>
                            <span class="p">)</span>
                            <span class="n">ng2</span> <span class="o">=</span> <span class="n">_reverse_to_source</span><span class="p">(</span>
                                <span class="n">target</span><span class="p">,</span> <span class="p">[</span><span class="n">inv_target_states</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">group2</span><span class="p">]</span>
                            <span class="p">)</span>

                            <span class="n">bookeeping</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ng1</span><span class="p">,</span> <span class="n">ng2</span><span class="p">))</span>

                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group1</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group2</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="n">new_groups</span> <span class="o">+=</span> <span class="n">new_g</span>

            <span class="c1"># End of iteration for the k-equivalence</span>
            <span class="c1"># Assign new groups and check if any change occured</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="n">new_groups</span>

        <span class="c1"># Make a copy of the old states, and prepare the</span>
        <span class="c1"># automaton to host the minimum states</span>

        <span class="n">oldstates</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define</span><span class="p">()</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">findpart</span><span class="p">(</span><span class="n">stateid</span><span class="p">,</span> <span class="n">partitions</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Searches for the groupt that the state identifier</span>
<span class="sd">            belongs to.</span>
<span class="sd">            Args:</span>
<span class="sd">                stateid (int): The state identifier</span>
<span class="sd">                partitions (list): The list of the groups</span>
<span class="sd">            Returns:</span>
<span class="sd">                set: The group that the stateid belongs to.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">partitions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">stateid</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">frozenset</span><span class="p">(</span><span class="nb">set</span><span class="p">())</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">add_state_if_not_exists</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">statesmap</span><span class="p">,</span> <span class="n">final</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Adds a new state in the final dfa. It initialy checks if</span>
<span class="sd">            the group of states is already registered to the automaton.</span>
<span class="sd">            If it is registered, the state identifier is returned, or</span>
<span class="sd">            else, a new state is added.</span>
<span class="sd">            Args:</span>
<span class="sd">                group (frozenset):  The group that the state identifier belongs</span>
<span class="sd">                statesmap (dict):   A dictionary that maintains the state</span>
<span class="sd">                                    identifiers for each forzenset</span>
<span class="sd">                final (bool):       A value indicating if the current state is</span>
<span class="sd">                                    final</span>
<span class="sd">            Returns:</span>
<span class="sd">                int: The new state identifier</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">statesmap</span><span class="p">:</span>
                <span class="n">sid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_state</span><span class="p">()</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="n">final</span>
                <span class="n">statesmap</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="n">sid</span>
            <span class="k">return</span> <span class="n">statesmap</span><span class="p">[</span><span class="n">group</span><span class="p">]</span>

        <span class="n">statesmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">findpart</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">groups</span><span class="p">)</span>
        <span class="n">sid</span> <span class="o">=</span> <span class="n">add_state_if_not_exists</span><span class="p">(</span>
            <span class="nb">frozenset</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">group</span><span class="p">)),</span> <span class="n">statesmap</span><span class="p">,</span> <span class="n">oldstates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">final</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">sid</span> <span class="o">=</span> <span class="n">add_state_if_not_exists</span><span class="p">(</span>
                <span class="nb">frozenset</span><span class="p">(</span><span class="n">group</span><span class="p">),</span> <span class="n">statesmap</span><span class="p">,</span> <span class="n">oldstates</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">group</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">final</span>
            <span class="p">)</span>
            <span class="n">state</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">group</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="n">oldstates</span><span class="p">[</span><span class="n">state</span><span class="p">]:</span>
                <span class="n">dst_group</span> <span class="o">=</span> <span class="n">findpart</span><span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">nextstate</span><span class="p">,</span> <span class="n">groups</span><span class="p">)</span>
                <span class="n">dst_sid</span> <span class="o">=</span> <span class="n">add_state_if_not_exists</span><span class="p">(</span>
                    <span class="n">dst_group</span><span class="p">,</span> <span class="n">statesmap</span><span class="p">,</span> <span class="n">oldstates</span><span class="p">[</span><span class="n">arc</span><span class="o">.</span><span class="n">nextstate</span><span class="p">]</span><span class="o">.</span><span class="n">final</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_arc</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">dst_sid</span><span class="p">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">isyms</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">ilabel</span><span class="p">))</span></div>


<div class="viewcode-block" id="PythonDFA.cross_product">
<a class="viewcode-back" href="../../../../symautomata.html#aria.automata.symautomata.pythondfa.PythonDFA.cross_product">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cross_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dfa_2</span><span class="p">,</span> <span class="n">accept_method</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A generalized cross-product constructor over two DFAs.</span>
<span class="sd">        The third argument is a binary boolean function f; a state (q1, q2) in the final</span>
<span class="sd">        DFA accepts if f(A[q1],A[q2]), where A indicates the acceptance-value of the state.</span>
<span class="sd">        Args:</span>
<span class="sd">            dfa_2: The second dfa</span>
<span class="sd">            accept_method: The boolean action</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dfa_1states</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
        <span class="n">dfa_2states</span> <span class="o">=</span> <span class="n">dfa_2</span><span class="o">.</span><span class="n">states</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">states</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_create_transitions_representation</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            In order to speedup the transition iteration using</span>
<span class="sd">            the alphabet, the function creates an index</span>
<span class="sd">            Args:</span>
<span class="sd">                graph (DFA): The input dfa</span>
<span class="sd">                state (DFA state): The examined state</span>
<span class="sd">            Returns:</span>
<span class="sd">                dict: The generated transition map</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">isyms</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">ilabel</span><span class="p">):</span> <span class="n">graph</span><span class="p">[</span><span class="n">arc</span><span class="o">.</span><span class="n">nextstate</span><span class="p">]</span> <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="n">state</span><span class="p">}</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_add_state_if_nonexistent</span><span class="p">(</span><span class="n">state_a</span><span class="p">,</span> <span class="n">state_b</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Adds a new state in the final dfa, which is the</span>
<span class="sd">            combination of the input states. The initial and final</span>
<span class="sd">            flag is also placed on the new state. If the state already</span>
<span class="sd">            exists, its identifier is being returned.</span>
<span class="sd">            Args:</span>
<span class="sd">                state_a: The fist state identifier</span>
<span class="sd">                state_b: The second state identifier</span>
<span class="sd">            Returns:</span>
<span class="sd">                int: The new state identifier</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">state_a</span><span class="o">.</span><span class="n">stateid</span><span class="p">,</span> <span class="n">state_b</span><span class="o">.</span><span class="n">stateid</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
                <span class="n">states</span><span class="p">[(</span><span class="n">state_a</span><span class="o">.</span><span class="n">stateid</span><span class="p">,</span> <span class="n">state_b</span><span class="o">.</span><span class="n">stateid</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_state</span><span class="p">()</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">states</span><span class="p">[(</span><span class="n">state_a</span><span class="o">.</span><span class="n">stateid</span><span class="p">,</span> <span class="n">state_b</span><span class="o">.</span><span class="n">stateid</span><span class="p">)]]</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">state_a</span><span class="o">.</span><span class="n">initial</span> <span class="ow">and</span> <span class="n">state_b</span><span class="o">.</span><span class="n">initial</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">states</span><span class="p">[(</span><span class="n">state_a</span><span class="o">.</span><span class="n">stateid</span><span class="p">,</span> <span class="n">state_b</span><span class="o">.</span><span class="n">stateid</span><span class="p">)]]</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="n">accept_method</span><span class="p">(</span>
                    <span class="n">state_a</span><span class="o">.</span><span class="n">final</span><span class="p">,</span> <span class="n">state_b</span><span class="o">.</span><span class="n">final</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">states</span><span class="p">[(</span><span class="n">state_a</span><span class="o">.</span><span class="n">stateid</span><span class="p">,</span> <span class="n">state_b</span><span class="o">.</span><span class="n">stateid</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">state1</span><span class="p">,</span> <span class="n">state2</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">dfa_1states</span><span class="p">,</span> <span class="n">dfa_2states</span><span class="p">):</span>
            <span class="n">sid1</span> <span class="o">=</span> <span class="n">_add_state_if_nonexistent</span><span class="p">(</span><span class="n">state1</span><span class="p">,</span> <span class="n">state2</span><span class="p">)</span>
            <span class="n">transitions_s1</span> <span class="o">=</span> <span class="n">_create_transitions_representation</span><span class="p">(</span><span class="n">dfa_1states</span><span class="p">,</span> <span class="n">state1</span><span class="p">)</span>
            <span class="n">transitions_s2</span> <span class="o">=</span> <span class="n">_create_transitions_representation</span><span class="p">(</span><span class="n">dfa_2states</span><span class="p">,</span> <span class="n">state2</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphabet</span><span class="p">:</span>
                <span class="n">sid2</span> <span class="o">=</span> <span class="n">_add_state_if_nonexistent</span><span class="p">(</span>
                    <span class="n">transitions_s1</span><span class="p">[</span><span class="n">char</span><span class="p">],</span> <span class="n">transitions_s2</span><span class="p">[</span><span class="n">char</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_arc</span><span class="p">(</span><span class="n">sid1</span><span class="p">,</span> <span class="n">sid2</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024-2025, ZJU Programming Languages and Automated Reasoning Group.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>